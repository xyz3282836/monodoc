# 性能之巅

## 方法

### 术语

- IOPS
- 吞吐量
- 响应时间
- 延时
- 使用率
- 饱和度
- 平均
- 工作负载
- 缓存

## 绪论

### 视角

- workload analysis
- resource analysis

### 性能工作

- 主观性

	- 技术领域是客户的
	- 性能常常是主观的

- 复杂性

	- 连锁故障cascading failure

- 多个原因
- 多个性能问题

	- 性能分析必须量化问题的重要程度（the performance analyst must quantify the magnitude of issues）

### 延迟latency

### 可观测性 Observability

- 计数器，统计数据和指标

	- 从计数器到报警

		- prometheus + grafana

			- 

- 剖析 profiling

	- cpu 火焰图

		- cpu问题
		- 其它类型通过留下cpu足迹来发现问题
		- 通过寻找自旋路径中cpu时间来发现锁竞争问题
		- 可以通过内存分配函数 malloc 中过多cpu时间来发现内存问题
		- 可以通过cpu时间花在那里来发现错误配置导致的性能问题

- 跟踪 tracing

	- 捕获事件数据并保存来供以后分析
用于系统调用 如linux中 strace，网络数据包 如linux tcpdump
分析所有软件和硬件事件执行情况的通用跟踪工具 如linux Ftrace，BCC和bpftrace

		- 静态检测
添加到源代码中的硬编码的软件检测点
		- 动态检测
通过修改内存指令插入检测程序来创建检测点

			- sun 2005年推出的DTrace
			- BPF berkeley packet filter

				- BPF 为编译器集合BCC和bpftrace前端提供来可编程能力

- 实验
- 云计算
- 方法

### linux 性能分析 60s

- 基于linux工具的一个检测表

	- uptime
	- dmesg -T | tail
	- vmstat -SM 1
	- mpstat -P ALL 1
	- pidstat 1
	- iostat -sxz 1
	- free -m
	- sar -n DEV 1
	- sar -n TCP,ETCP 1
	- top

