# pcmalloc vs tcmalloc

## tcmalloc

tcmalloc 使用细颗粒度的高效自旋锁，ptmalloc2 使用 per-thread arenas

tcmalloc 每个线程分配一个本地线程缓存，小的分配直接放在里面；对象可以从中心堆移动到本地线程缓存，并且周期行进行 gc，将内存从本地线程缓存移动到中心缓存。

tcmalloc 对应小于 32K 的小对象和大对象处理方式不同。大对象使用中心堆，通过页分配器（一页 4K，通常是一些列的页）。

一些列的页分割成大小相同的小对象，如一页 4K 可以分成 32 个 128 字节对象。

### 小对象分配

### 大对象分配

### span

### 内存回收
